<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>חיוך העל של מילאי</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap");
      body {
        font-family: "Assistant", sans-serif;
        background-color: #f0f2f5;
        overflow: auto; /* Prevent body scroll */
        min-height: 100vh;
      }
      html,
      body {
        overflow: auto !important;
        -webkit-overflow-scrolling: touch !important;
        height: auto !important;
        min-height: 100% !important;
        position: relative !important;
      }
      .storybook-container {
        max-width: 1100px;
        width: 100%;
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.25);
        border-radius: 0.5rem;
        display: flex;
        flex-direction: column;
        min-height: 80vh; /* Your change */
        background-color: #fff;
        height: auto !important; /* Your change */
        max-height: 85vh;
        /* iOS iframe fixes */
        position: relative;
        overflow: visible;
      }
      .storybook-body {
        flex-grow: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        padding: 1rem;
        overflow-y: auto;
      }
      /* Cover Page Styles */
      .cover-page {
        width: 50%; /* Cover takes full width of the body */
        height: 100%;
        background-size: cover;
        background-position: center;
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.25rem;
      }
      .cover-title {
        color: white;
        font-size: 2.8rem;
        font-weight: 700;
        text-shadow: 0px 2px 10px rgba(0, 0, 0, 0.8);
        padding: 1.5rem;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 0.5rem;
        text-align: center;
      }
      /* Two-page Spread Styles */
      .spread-container {
        display: flex;
        width: 100%;
        height: 100%;
        gap: 1rem;
      }
      .page {
        width: 50%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #fff;
        border-radius: 0.25rem;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      .page.text-page {
        padding: 2.5rem;
        text-align: center;
      }
      .page.image-page {
        padding: 1rem; /* Add padding around the image */
        background-color: #f9fafb; /* Light gray background for the image page */
      }
      .page-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 0.5rem;
      }
      .page p {
        font-size: 1.5rem;
        line-height: 1.7;
      }
      .nav-button {
        transition: all 0.2s ease-in-out;
        border: 1px solid #d1d5db;
      }
      .nav-button:hover:not(:disabled) {
        background-color: #e5e7eb;
        transform: scale(1.05);
      }
      .nav-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* --- Responsive Styles for Mobile & Zoom --- */
      @media (max-width: 768px) {
        .storybook-body {
          padding: 0.5rem;
        }
        .cover-page {
          width: 100%;
        }
        .cover-title {
          font-size: 1.8rem;
        }
        .spread-container {
          flex-direction: column; /* Stack pages vertically */
          height: 100%;
          width: 100%;
        }
        .page {
          width: 100%;
          height: 50%; /* Each page takes half the vertical space */
        }
        .page.image-page {
          padding: 0.5rem;
        }
        .page.text-page {
          padding: 1rem;
        }
        .page p {
          font-size: 1.1rem; /* Adjust font size for mobile */
          line-height: 1.6;
        }
        html,
        body {
          height: auto !important;
          max-height: none !important;
          overflow: auto !important;
          -webkit-overflow-scrolling: touch !important;
        }

        .storybook-container {
          /* CRITICAL: Different handling based on content */
          max-height: 80vh !important;
          overflow: auto !important;
          position: relative !important;
          margin: 0 !important;
          -webkit-overflow-scrolling: touch;
          transform: translateZ(0);
        }

        /* SPECIAL HANDLING FOR COVER PAGE */
        .storybook-container:has(.cover-page),
        .storybook-container .cover-page {
          /* Cover page needs fixed height to maintain image size */
          height: 80vh !important;
          min-height: 80vh !important;
        }

        .cover-page {
          /* Ensure cover image displays properly */
          width: 100% !important; /* Changed from 50% to full width on mobile */
          height: 70vh !important; /* Fixed height for proper image display */
          min-height: 400px !important; /* Minimum size fallback */
          background-size: cover !important;
          background-position: center !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }

        .cover-title {
          /* Ensure title is visible over image */
          font-size: 1.8rem !important;
          text-shadow: 0px 2px 10px rgba(0, 0, 0, 0.8) !important;
          background-color: rgba(0, 0, 0, 0.4) !important;
          padding: 1rem !important;
          border-radius: 0.5rem !important;
          margin: 1rem !important;
        }

        /* REGULAR PAGES (not cover) */
        .storybook-container:not(:has(.cover-page)) {
          /* Regular pages get flexible height */
          height: auto !important;
          min-height: 75vh !important;
        }

        .storybook-body {
          /* Allow flexible height within container */
          overflow-y: auto !important;
          max-height: none !important;
          flex: 1;
        }

        /* Ensure navigation buttons are always accessible */
        .nav-button {
          margin: 5px !important;
          padding: 8px 16px !important;
          font-size: 0.9em !important;
        }

        /* Fix for spread containers */
        .spread-container {
          height: auto !important;
          min-height: 60vh !important;
        }
      }
      /* iOS Safari specific */
      @supports (-webkit-touch-callout: none) {
        body {
          -webkit-overflow-scrolling: touch !important;
          overflow-y: auto !important;
        }

        .storybook-container {
          -webkit-overflow-scrolling: touch;
          transform: translateZ(0); /* Hardware acceleration */
        }

        @media (max-width: 768px) {
          .cover-page {
            height: 70vh !important;
            min-height: 400px !important;
            -webkit-overflow-scrolling: touch !important;
          }

          .storybook-container {
            max-height: 80vh !important;
            overflow-y: scroll !important;
            -webkit-overflow-scrolling: touch !important;
          }
        }
      }
    </style>
  </head>
  <body class="flex items-center justify-center min-h-screen p-4">
    <div class="storybook-container">
      <div id="storybook-body" class="storybook-body">
        <!-- Content is rendered here by JavaScript -->
      </div>
      <div
        class="flex-shrink-0 flex justify-between items-center p-4 bg-gray-100 border-t"
      >
        <button
          id="prev-button"
          class="nav-button bg-white text-gray-800 font-bold py-2 px-6 rounded-full shadow-sm"
        >
          הקודם
        </button>
        <div
          id="page-indicator"
          class="text-gray-700 font-semibold text-lg"
        ></div>
        <button
          id="next-button"
          class="nav-button bg-white text-gray-800 font-bold py-2 px-6 rounded-full shadow-sm"
        >
          הבא
        </button>
      </div>
    </div>

    <script>
      // --- Story Data ---
      const storyData = [
        { type: "cover", image: "images/1.jpg", title: "חיוך העל של מילאי" },
        // Spread 1
        { type: "image", src: "images/2.jpg" },
        {
          type: "text",
          content:
            'זאת מילאי. למילאי יש תלתלים קופצניים וחיוך מיוחד במינו. כשהיא מחייכת את "חיוך העל" שלה, אף אחד לא יכול לסרב לה.',
        },
        // Spread 2
        {
          type: "text",
          content:
            'יום אחד, אמא של מילאי הכינה עוגת שוקולד טעימה. "העוגה הזאת היא הפתעה לארוחת הערב," אמרה אמא. "אסור לאכול אותה עדיין."',
        },
        { type: "image", src: "images/3.jpg" },
        // Spread 3
        { type: "image", src: "images/4.jpg" },
        {
          type: "text",
          content:
            "מילאי הריחה את ריח השוקולד המתוק. הבטן שלה קרקרה. היא ממש רצתה חתיכה מהעוגה.",
        },
        // Spread 4
        {
          type: "text",
          content:
            'היא ניגשה לאמא שלה, חייכה את "חיוך העל" שלה ושאלה, "אפשר רק חתיכה קטנטנה?"',
        },
        { type: "image", src: "images/5.jpg" },
        // Spread 5
        { type: "image", src: "images/6.jpg" },
        {
          type: "text",
          content:
            'אמא של מילאי לא יכלה לעמוד בפני החיוך המתוק הזה. "טוב, אבל רק חתיכה קטנה," היא אמרה ונתנה למילאי חתיכה קטנה מהעוגה.',
        },
        // Spread 6
        {
          type: "text",
          content:
            'מאוחר יותר, מילאי רצתה לצייר. אמא שלה הכינה לה צבעים ודפים ואמרה, "תציירי בזהירות, טוב? כדי שהצבע לא ילכלך שום דבר."',
        },
        { type: "image", src: "images/7.jpg" },
        // Spread 7
        { type: "image", src: "images/8.jpg" },
        {
          type: "text",
          content:
            "מילאי ציירה פרח גדול ויפה, אבל מרוב התלהבות, המכחול שלה החליק וכתם של צבע כחול קפץ ישר על הקיר הלבן!",
        },
        // Spread 8
        {
          type: "text",
          content:
            'בדיוק אז אמא נכנסה לחדר. היא ראתה את כתם הצבע ונעשתה רצינית. מילאי מיד חייכה את "חיוך העל" שלה, בתקווה שאמא לא תכעס.',
        },
        { type: "image", src: "images/9.jpg" },
        // Spread 9
        { type: "image", src: "images/10.jpg" },
        {
          type: "text",
          content:
            'אבל הפעם, החיוך לא עבד. "מילאי," אמרה אמא, "החיוך שלך מקסים, אבל הוא לא יכול לנקות את הקיר. כשעושים טעות, צריך לקחת אחריות."',
        },
        // Spread 10
        {
          type: "text",
          content:
            'מילאי הבינה. היא חיבקה את אמא. "אני מצטערת. אני אעזור לך לנקות," היא אמרה. וביחד, הן ניקו את הקיר. הפעם, מילאי לא השתמשה ב"חיוך העל", אלא בחיוך אמיתי, מלא אהבה.',
        },
        { type: "image", src: "images/11.jpg" },
      ];
      // --- DOM Elements ---
      const storybookBody = document.getElementById("storybook-body");
      const prevButton = document.getElementById("prev-button");
      const nextButton = document.getElementById("next-button");
      const pageIndicator = document.getElementById("page-indicator");

      // --- State ---
      let currentPageIndex = 0; // 0 for cover, 1 for first spread, 3, 5, etc.

      // --- Functions ---

      function updateButtons() {
        prevButton.disabled = currentPageIndex === 0;
        // Disable 'next' if the next spread index is out of bounds
        nextButton.disabled = currentPageIndex + 2 >= storyData.length;
      }

      function updatePageIndicator() {
        if (currentPageIndex === 0) {
          pageIndicator.textContent = "כריכה";
        } else {
          const rightPageNum = currentPageIndex + 1;
          pageIndicator.textContent = `עמודים ${currentPageIndex}-${rightPageNum}`;
        }
      }

      function renderPage(pageData) {
        const pageElement = document.createElement("div");

        if (pageData.type === "image") {
          pageElement.classList.add("page", "image-page");
          const imageElement = document.createElement("img");
          imageElement.src = pageData.src;
          imageElement.classList.add("page-image");
          imageElement.onerror = () =>
            (imageElement.src =
              "https://placehold.co/500x700/e2e8f0/4a5568?text=Image+Not+Found");
          pageElement.appendChild(imageElement);
        } else if (pageData.type === "text") {
          pageElement.classList.add("page", "text-page");
          const textElement = document.createElement("p");
          textElement.classList.add("text-gray-800", "leading-relaxed");
          textElement.textContent = pageData.content;
          pageElement.appendChild(textElement);
        }
        return pageElement;
      }

      function render() {
        storybookBody.innerHTML = ""; // Always clear previous content

        if (currentPageIndex === 0) {
          // Render Cover
          const coverData = storyData[0];
          const coverElement = document.createElement("div");
          coverElement.classList.add("cover-page");
          coverElement.style.backgroundImage = `url('${coverData.image}')`;
          const titleElement = document.createElement("h1");
          titleElement.classList.add("cover-title");
          titleElement.textContent = coverData.title;
          coverElement.appendChild(titleElement);
          storybookBody.appendChild(coverElement);
        } else {
          // Render a two-page spread
          const spreadContainer = document.createElement("div");
          spreadContainer.classList.add("spread-container");

          const rightPageData = storyData[currentPageIndex];
          if (rightPageData) {
            spreadContainer.appendChild(renderPage(rightPageData));
          }

          const leftPageData = storyData[currentPageIndex + 1];
          if (leftPageData) {
            spreadContainer.appendChild(renderPage(leftPageData));
          }

          storybookBody.appendChild(spreadContainer);
        }

        updatePageIndicator();
        updateButtons();
      }

      // --- Event Listeners ---
      prevButton.addEventListener("click", () => {
        if (currentPageIndex > 0) {
          // If on the first spread, go to cover. Otherwise, go back 2 pages.
          currentPageIndex = currentPageIndex === 1 ? 0 : currentPageIndex - 2;
          render();
        }
      });

      nextButton.addEventListener("click", () => {
        if (currentPageIndex + 2 < storyData.length) {
          // If on cover, go to first spread. Otherwise, advance 2 pages.
          currentPageIndex = currentPageIndex === 0 ? 1 : currentPageIndex + 2;
          render();
        }
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight" && !nextButton.disabled) nextButton.click();
        else if (e.key === "ArrowLeft" && !prevButton.disabled)
          prevButton.click();
      });

      // --- Initial Load ---
      document.addEventListener("DOMContentLoaded", render);
    </script>
  </body>
</html>
